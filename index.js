(()=>{"use strict";var e={d:(r,t)=>{for(var s in t)e.o(t,s)&&!e.o(r,s)&&Object.defineProperty(r,s,{enumerable:!0,get:t[s]})},o:(e,r)=>Object.prototype.hasOwnProperty.call(e,r),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},r={};e.r(r),e.d(r,{BotBye:()=>t});class t{serverKey;url;constructor(e){this.serverKey=e.serverKey,this.url=e.url??"verify.botbye.com"}validateRequest(e){if(!this.serverKey)throw new Error("Init method with serverKey should be called first");const{request:r,customFields:t,token:s}=e;return this.makeRequest({requestInfo:{remote_addr:this.extractIp(r),request_uri:new URL(r.url).pathname,request_method:r.method},headers:this.extractHeaders(r),token:s,customFields:t})}getFallbackResponse(e){return{reqId:"00000000-0000-0000-0000-000000000000",result:{isAllowed:!0},error:{message:"[BotBye] "+e}}}makeRequest(e){return new Promise((r=>{const t=setTimeout((()=>{r(this.getFallbackResponse("Connection Timeout"))}),300),s=JSON.stringify({server_key:this.serverKey,request_info:e.requestInfo,headers:e.headers,custom_fields:e.customFields??{}});fetch(`https://${this.url}/validate-request/v2?`+encodeURI(e.token),{method:"POST",headers:{"Module-Name":"Cloudflare-Worker","Module-Version":"0.1.0",Connection:"keep-alive"},body:s}).then((e=>{clearTimeout(t),r(e.json())})).catch((e=>{const t=e instanceof Error?e.message:"UNKNOWN";r(this.getFallbackResponse(t))}))}))}extractHeaders(e){return Array.from(e.headers).reduce(((e,[r,t])=>(e[r]=e[r]?e[r]+`; ${t}`:t,e)),{})}extractIp(e){return e.headers.get("CF-Connecting-IP")??"0.0.0.0"}}var s=exports;for(var o in r)s[o]=r[o];r.__esModule&&Object.defineProperty(s,"__esModule",{value:!0})})();